const t=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=t.map(t=>[...t]),this.grid=t.map(t=>[...t]),this.score=0,this.status="idle"}moveLeft(){if("playing"!==this.status)return;let t=JSON.stringify(this.grid);this.grid=this.grid.map(t=>this._slideAndMerge(t)),this._postMoveHandler(t)}moveRight(){if("playing"!==this.status)return;let t=JSON.stringify(this.grid);this.grid=this.grid.map(t=>this._slideRight(t)),this.grid=this.grid.map(t=>this._mergeRight(t)),this._postMoveHandler(t)}_slideRight(t){let e=t.filter(t=>0!==t),s=[,,,,].fill(0),i=3;for(let t=e.length-1;t>=0;t--)s[i--]=e[t];return s}_mergeRight(t){let e=t.slice();for(let t=3;t>0;t--)e[t]===e[t-1]&&0!==e[t]&&(e[t]*=2,this.score+=e[t],e[t-1]=0);return this._slideRight(e)}moveUp(){if("playing"!==this.status)return;let t=JSON.stringify(this.grid);this._transposeGrid(),this.grid=this.grid.map(t=>this._slideAndMerge(t)),this._transposeGrid(),this._postMoveHandler(t)}moveDown(){if("playing"!==this.status)return;let t=JSON.stringify(this.grid);this._transposeGrid(),this.grid=this.grid.map(t=>this._slideAndMerge(t.reverse()).reverse()),this._transposeGrid(),this._postMoveHandler(t)}getScore(){return this.score}getState(){return this.grid}getStatus(){return this.status}start(){"idle"===this.status&&(this.status="playing",this._addRandomCell(),this._addRandomCell())}restart(){this.score=0,this.grid=this.initialState.map(t=>[...t]),this.status="idle"}_slideAndMerge(t){let e=t.filter(t=>0!==t),s=[],i=!1;for(let t=0;t<e.length;t++){if(i){i=!1;continue}e[t]===e[t+1]?(s.push(2*e[t]),this.score+=2*e[t],i=!0):s.push(e[t])}for(;s.length<4;)s.push(0);return s}_transposeGrid(){this.grid=this.grid[0].map((t,e)=>this.grid.map(t=>t[e]))}_addRandomCell(){let t=[];for(let e=0;e<this.grid.length;e++)for(let s=0;s<this.grid[e].length;s++)0===this.grid[e][s]&&t.push({row:e,col:s});if(t.length>0){let e=Math.floor(Math.random()*t.length),{row:s,col:i}=t[e];this.grid[s][i]=.9>Math.random()?2:4}}_postMoveHandler(t){JSON.stringify(this.grid)===t||(this._addRandomCell(),this._checkWin()?this.status="win":this._hasAvailableMoves()||(this.status="lose"))}_checkWin(){return this.grid.some(t=>t.some(t=>2048===t))}_hasAvailableMoves(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(0===this.grid[t][e]||e<3&&this.grid[t][e]===this.grid[t][e+1]||t<3&&this.grid[t][e]===this.grid[t+1][e])return!0;return!1}},e=document.querySelector(".button"),s=document.querySelector(".game-score"),i=document.querySelector(".message-start"),r=document.querySelector(".message-win"),a=document.querySelector(".message-lose"),d=document.querySelectorAll(".field-cell");function l(){let e=t.getState();d.forEach((t,s)=>{let i=e[Math.floor(s/4)][s%4];t.textContent=0===i?"":i,t.className=`field-cell ${i?`field-cell--${i}`:""}`}),s.textContent=t.getScore()}e.addEventListener("click",()=>{e.classList.contains("start")?(t.start(),e.classList.remove("start"),e.classList.add("restart"),e.textContent="Restart",i.classList.add("hidden")):(t.restart(),e.classList.remove("restart"),e.classList.add("start"),e.textContent="Start",r.classList.add("hidden"),a.classList.add("hidden"),i.classList.remove("hidden")),l()}),document.addEventListener("keydown",function(e){if("playing"===t.getStatus()){switch(e.key){case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight();break;case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown();break;default:return}l(),"win"===t.getStatus()?r.classList.remove("hidden"):"lose"===t.getStatus()&&a.classList.remove("hidden")}});
//# sourceMappingURL=index.cf4f6e48.js.map
